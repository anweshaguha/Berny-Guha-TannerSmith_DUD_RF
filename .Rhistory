ds1 <- mutate(ds1, weapon1 = ifelse(weapon1 > 0, 1, 0))
ds1 <- mutate(ds1, weapon2a = ifelse(weapon2a > 0, 1, 0))
ds1$weapon1 <- factor(ds1$weapon1, levels = c(0, 1), labels = c("No", "Yes"))
ds1$weapon2a <- factor(ds1$weapon2a, levels = c(0, 1), labels = c("No", "Yes"))
ds1$earlyinit_mj <- with(ds1, ifelse(agepot >= 1 & agepot <= 7, "Yes",
ifelse(agepot == 0 | agepot >= 8, "No", NA)))
ds1$earlyinit_mj <- factor(ds1$earlyinit_mj, levels = c("No", "Yes"))
ds1$earlyinit_alc <- with(ds1, ifelse(agedrk >= 1 & agedrk <= 7, "Yes",
ifelse(agedrk == 0 | agedrk >= 8, "No", NA)))
ds1$earlyinit_alc <- factor(ds1$earlyinit_alc, levels = c("No", "Yes"))
# Create a function to recode the variables
recode_age <- function(x) {
ifelse(x >= 1 & x <= 7, "Yes",
ifelse(x == 0 | x >= 8, "No", NA))
}
# Apply the recoding function to each variable and store the result in a new column
ds1$earlyinit_oth <- with(ds1,
ifelse(recode_age(agecoc) == "Yes" |
recode_age(agemeth) == "Yes" |
recode_age(ageinhal) == "Yes" |
recode_age(agehal) == "Yes" |
recode_age(ageop) == "Yes" |
recode_age(ageprstim) == "Yes" |
recode_age(ageprsed) == "Yes" |
recode_age(ageprop) == "Yes", "Yes", "No"))
# Columns to include in the calculation
age_columns <- c("agepot", "agecoc", "agemeth", "ageinhal", "agehal", "ageop", "ageprstim",
"ageprsed", "ageprop", "agedrk")
# Function to find the minimum value greater than zero or return NA if only zeros or NAs
min_nonzero <- function(row) {
non_zero_values <- row[row > 0 & !is.na(row)]
if (length(non_zero_values) == 0) {
return(NA)
} else {
return(min(non_zero_values, na.rm = TRUE))
}
}
# Apply the function to the relevant columns
ds1$agedruginit <- apply(ds1[age_columns], 1, min_nonzero)
ds1$agedruginit <- ds1$agedruginit + 7 #to make years rather than Likert
ds1$sexint <- factor(ds1$sex, levels = c(0, 1), labels = c("No", "Yes"))
ds1$binge <- factor(ds1$binge, levels = c(0, 1), labels = c("No", "Yes"))
ds1$publicass <- factor(ds1$publicass, levels = c(0, 1), labels = c("No", "Yes"))
ds1$partnervic <- factor(ds1$partnervic, levels = c(0, 1), labels = c("No", "Yes"))
ds1$pcts <- factor(ds1$pcts, levels = c(0, 1), labels = c("No", "Yes"))
ds2$vgroup <- factor(ds2$vgroup, levels = c(0, 1),
labels = c("Comparison Group", "Assaulted Group"))
ds2$alcdx <- factor(ds2$alcdx, levels = c(0, 1), labels = c("No", "Yes"))
ds2$drugdx <- factor(ds2$drugdx, levels = c(0, 1), labels = c("No", "Yes"))
ds2$ptsd <- factor(ds2$ptsd, levels = c(0, 1), labels = c("No", "Yes"))
ds2$cdapd <- factor(ds2$conductdisorder, levels = c(0, 1), labels = c("No", "Yes"))
ds2$legalsev <- ds2$asiteen11
ds2 <- mutate(ds2, personalcrime = ifelse(asiteen2_c1g1 > 0, 1, 0))
ds2 <- mutate(ds2, propertycrime = ifelse(asiteen2_c1g2 > 0, 1, 0))
ds2 <- mutate(ds2, drugcrime = ifelse(asiteen2_c1g3 > 0, 1, 0))
ds2 <- mutate(ds2, publicorder = ifelse(asiteen2_c1g4 > 0, 1, 0))
ds2 <- mutate(ds2, parprobcc = ifelse(asiteen2_c1g5 > 0, 1, 0))
ds2$sexdrug <- factor(ds2$sexdrug, levels = c(0, 1), labels = c("No", "Yes"))
ds2$mentman <- factor(ds2$mentman, levels = c(0, 1), labels = c("No", "Yes"))
ds2$mentwoman <- factor(ds2$mentwoman, levels = c(0, 1), labels = c("No", "Yes"))
ds3$vgroup <- factor(ds3$vgroup, levels = c(0, 1),
labels = c("Comparison Group", "Assaulted Group"))
ds3$alcdx <- factor(ds3$alcdx, levels = c(0, 1), labels = c("No", "Yes"))
ds3$drugdx <- factor(ds3$drugdx, levels = c(0, 1), labels = c("No", "Yes"))
ds3$ptsd <- factor(ds3$ptsd, levels = c(0, 1), labels = c("No", "Yes"))
ds3$cdapd <- factor(ds3$apd, levels = c(0, 1), labels = c("No", "Yes"))
ds3$legalsev <- ds3$asi12
ds3$sexdrug <- factor(ds3$sexdrug, levels = c(0, 1), labels = c("No", "Yes"))
ds3$mentman <- factor(ds3$mentman, levels = c(0, 1), labels = c("No", "Yes"))
ds3$mentwoman <- factor(ds3$mentwoman, levels = c(0, 1), labels = c("No", "Yes"))
ds3 <- mutate(ds3, personalcrime = ifelse(asi2_c1g1 > 0, 1, 0))
ds3 <- mutate(ds3, propertycrime = ifelse(asi2_c1g2 > 0, 1, 0))
ds3 <- mutate(ds3, drugcrime = ifelse(asi2_c1g3 > 0, 1, 0))
ds3 <- mutate(ds3, publicorder = ifelse(asi2_c1g4 > 0, 1, 0))
ds3 <- mutate(ds3, parprobcc = ifelse(asi2_c1g5 > 0, 1, 0))
ds1$grades_rev <- 10 - ds1$grades #reverse
ds1$reatt_rev <- 35 - ds1$reatt #reverse
ds1$fight <- rowMeans(ds1[, c("fight1", "fight2", "fight3", "fight4")], na.rm = TRUE)
ds2$dui <- rowMeans(ds2[, c("dui1", "dui2", "dui3", "dui4", "dui5")], na.rm = TRUE)
ds2$infrndps <- rowMeans(ds2[, c("infrndps1", "infrndps2", "infrndps3", "infrndps4")],
na.rm = TRUE)
ds2$infrndng <- rowMeans(ds2[, c("infrndng1", "infrndng5", "infrndng6", "infrndng10",
"infrndng12", "infrndng13", "infrndng15")],
na.rm = TRUE)
ds2$parntsup <- rowMeans(ds2[, c("parntsup1", "parntsup2", "parntsup3", "parntsup4",
"parntsup5", "parntsup6")],
na.rm = TRUE)
ds2$prntdral <- rowMeans(ds2[, c("prntdral3", "prntdral4", "prntdral6", "prntdral10")],
na.rm = TRUE)
ds2$famanger <- rowMeans(ds2[, c("famanger1", "famanger2", "famanger3", "famanger4")],
na.rm = TRUE)
ds2$nofight <- rowMeans(ds2[, c("nofight_r1", "nofight_r2", "nofight_r3", "nofight_r4",
"nofight_r5")],
na.rm = TRUE)
ds2$commviol <- rowMeans(ds2[, c("commviol1", "commviol3", "commviol5", "commviol10")],
na.rm = TRUE)
ds3$dui <- rowMeans(ds3[, c("dui1", "dui2", "dui3", "dui4", "dui5")], na.rm = TRUE)
ds3$infrndps <- rowMeans(ds3[, c("infrndps1", "infrndps2", "infrndps3", "infrndps4")],
na.rm = TRUE)
ds3$infrndng <- rowMeans(ds3[, c("infrndng1", "infrndng5", "infrndng6", "infrndng10",
"infrndng12", "infrndng13", "infrndng15")],
na.rm = TRUE)
ds3$parntsup <- rowMeans(ds3[, c("parntsup1", "parntsup2", "parntsup3", "parntsup4",
"parntsup5", "parntsup6")],
na.rm = TRUE)
ds3$prntdral <- rowMeans(ds3[, c("prntdral3", "prntdral4", "prntdral6", "prntdral10")],
na.rm = TRUE)
ds3$famanger <- rowMeans(ds3[, c("famanger1", "famanger2", "famanger3", "famanger4")],
na.rm = TRUE)
ds3$nofight <- rowMeans(ds3[, c("nofight_r1", "nofight_r2", "nofight_r3", "nofight_r4",
"nofight_r5")],
na.rm = TRUE)
ds3$commviol <- rowMeans(ds3[, c("commviol1", "commviol3", "commviol5", "commviol10")],
na.rm = TRUE)
ds3$commviol <- rowMeans(ds3[, c("commviol1", "commviol3", "commviol5", "commviol10")],
na.rm = TRUE)
ds3$sedare <- 6 - rowMeans(ds3[, c("sedare1", "sedare2", "sedare3", "sedare4", "sedare5",
"sedare6", "sedare7", "sedare8")], na.rm = TRUE) #reverse
ds3$sedarea <- 6 - rowMeans(ds3[, c("sedarea1", "sedarea2", "sedarea3", "sedarea4", "sedarea5",
"sedarea6", "sedarea7", "sedarea8")], na.rm = TRUE) #reverse
ds2$crime <- rowSums(ds2[, c("personalcrime", "propertycrime", "drugcrime", "publicorder",
"parprobcc")], na.rm = TRUE)
ds3$crime <- rowSums(ds3[, c("personalcrime", "propertycrime", "drugcrime", "publicorder",
"parprobcc")], na.rm = TRUE)
ds1 <- ds1 %>%
select(deid, demoage, demosex, demorac, livewith, school, gang1, weapon1, weapon2a,
sexint, publicass, partnervic, pcts, fight, grades_rev, reatt_rev, pviclevel,
pagglevel, binge, agedruginit)
ds2 <- ds2 %>%
select(deid, vgroup, alcdx, drugdx, ptsd, cdapd, legalsev, sexdrug, mentman, mentwoman,
dui, infrndps, infrndng, parntsup, prntdral, famanger, nofight, commviol,
bsi, anx, nprcts1to13, npects1to13, crime, sedare1, sedare2, sedare3, sedare4, sedare5,
sedare6, sedare7, sedare8)
ds3 <- ds3 %>%
select(deid, vgroup, alcdx, drugdx, ptsd, cdapd, legalsev, sexdrug, mentman, mentwoman,
dui, infrndps, infrndng, parntsup, prntdral, famanger, nofight, commviol,
bsi, anx, nprcts1to13, npects1to13, crime, sedare1, sedare2, sedare3, sedare4, sedare5,
sedare6, sedare7, sedare8)
ds23 <- smartbind(ds2, ds3)
rownames(ds23) <- NULL
dat <- merge(ds1, ds23, by = "deid")
dat$legalsev <- as.integer(dat$legalsev)
dat$agedruginit <- as.integer(dat$agedruginit)
dat$sedare1 <- as.integer(dat$sedare1)
dat$sedare2 <- as.integer(dat$sedare2)
dat$sedare3 <- as.integer(dat$sedare3)
dat$sedare4 <- as.integer(dat$sedare4)
dat$sedare5 <- as.integer(dat$sedare5)
dat$sedare6 <- as.integer(dat$sedare6)
dat$sedare7 <- as.integer(dat$sedare7)
dat$sedare8 <- as.integer(dat$sedare8)
dat$npects1to13 <- as.integer(dat$npects1to13)
dat$nprcts1to13 <- as.integer(dat$nprcts1to13)
dat$crime <- as.integer(dat$crime)
dat$anx <- as.integer(dat$anx)
dat$bsi <- as.integer(dat$bsi)
dat$pviclevel <- as.integer(dat$pviclevel)
dat$pagglevel <- as.integer(dat$pagglevel)
dat$reatt_rev <- as.integer(dat$reatt_rev)
dat$grades_rev <- as.integer(dat$grades_rev)
#str(dat)
dat %>%
missing_plot()
dat %>%
missing_glimpse() %>%
arrange(desc(missing_n))
missing_columns <- colnames(dat)[apply(dat, 2, function(x) any(is.na(x)))]
dat <- dat %>%
relocate(drugdx)
factor_cols_more_than_2_levels <- names(Filter(function(x) is.factor(x) && length(levels(x)) > 2, dat))
blueprint <- recipe(x = dat, vars  = colnames(dat),
roles = c('outcome', 'id', rep('predictor', 48))) %>%
step_impute_bag(all_of(missing_columns), seed_val = sample.int(10312022)) %>%
step_dummy(all_of(factor_cols_more_than_2_levels),one_hot=TRUE)
# blueprint
predictions <- rforest[["pred"]]
# Initialize an empty matrix to store results
xv_results <- matrix(NA, nrow = 10, ncol = 7,
dimnames = list(NULL, c("Fold", "AUC", "ACC", "PRE", "FPR", "TNR", "TPR")))
# Loop through each fold
for (i in 1:10) {
# Subset the predictions dataframe for the current fold
fold <- subset(predictions, Resample == paste0("Resample", sprintf("%02d", i)))
# Create confusion matrix
conf_matrix <- confusionMatrix(data = factor(fold$pred), reference = factor(fold$obs), positive = "Yes")
# Extract the confusion matrix
cm <- conf_matrix$table
# Calculate True Positives (TP), True Negatives (TN), False Positives (FP)
TN <- cm["No",  "No"]
FN <- cm["No",  "Yes"]
FP <- cm["Yes", "No"]
TP <- cm["Yes", "Yes"]
# Calculate Accuracy
ACC <- (TP + TN) / sum(cm)
# Calculate Precision
PRE <- TP / (TP + FP)
# Calculate False Positive Rate (FPR)
FPR <- FP / (FP + TN)
# Calculate True Negative Rate (TNR)
TNR <- TN / (TN + FP)
# Calculate True Positive Rate (TPR)
TPR <- TP / (TP + FN)
# Calculate AUC using cutpointr
cut.obj <- cutpointr(x = fold$Yes, class = fold$obs)
AUC <- auc(cut.obj)
# Store results in the matrix
xv_results[i, ] <- c(i, AUC, ACC, PRE, FPR, TNR, TPR)
}
# Print the results matrix
xv_results <- as.data.frame(xv_results)
# Calculate mean and standard deviation and round to the second decimal point
mean_values <- sapply(xv_results[, -1], function(x) round(mean(x), 2))
sd_values <- sapply(xv_results[, -1], function(x) round(sd(x), 2))
# Print means and standard deviations
cat("Mean:\n")
print(mean_values)
cat("\nStandard Deviation:\n")
print(sd_values)
fitted_rf_model <- rforest$finalModel #pull ranger model from rforest list
prepped_recipe <- prep(blueprint, training = dat)
varimp <- perm %>%
mutate(permimp = `rforest[["finalModel"]][["variable.importance"]]`) %>%
dplyr::select(-`rforest[["finalModel"]][["variable.importance"]]`) %>%
arrange(desc(permimp)) %>%
dplyr::select(variable, permimp)
# Define your custom colors
drwhycolors <- c("Risk Factor" = "#371ea3",
"Protective Factor" = "#8bdcbe",
"Demographic/Personal Characteristic" = "#f05a71")
impplot <- varimp %>%
mutate(labels = c("Intoxicated Driving", "Negative Peer Influence",
"Alcohol Use Disorder", "Tempted - Let Myself Down",
"Conduct Disorder or ASPD", "Drug Initiation Age",
"Crime", "Tempted - Family Problems",
"Biological Sex", "Academic Performance",
"Tempted - Friend Problems", "Anxiety",
"Non-Partner Violence Perpetration", "Legal Severity",
"Tempted - All Friends Were Doing It", "Gang Affiliation",
"Fight Avoidance", "Intoxicated Sex",
"Community Violence", "Depression",
"Positive Peer Influence", "Parent Support",
"Family Anger", "Tempted - People Didn't Like Me",
"Tempted - Worried About a Problem", "Aged 14-17",
"Tempted - Friends Would Like Me More", "Tempted - Made Fun of For Abstaining",
"Retaliation Attitudes", "Fighting Behavior",
"Knife/Razor Carrying", "Aged 18-20",
"IPV Victimization Severity", "IPV Perpetration Severity",
"IPV", "Non-Partner Violence Victimization",
"Binge Drinking", "White Race",
"Parent Substance Use", "Living With Parents",
"Firearm Carrying", "Study Group",
"Black Race", "IPV Victimization",
"Male Mentorship", "Posttraumatic Stress Disorder",
"Attending School", "Sexual Intercourse",
"Other Race", "Multiple Races",
"Female Mentorship", "Public Assistance",
"Aged 21-24"),
category = c("Risk Factor", "Risk Factor",
"Risk Factor", "Risk Factor",
"Risk Factor", "Protective Factor",
"Risk Factor", "Risk Factor",
"Demographic/Personal Characteristic", "Protective Factor",
"Risk Factor", "Risk Factor",
"Risk Factor", "Risk Factor",
"Risk Factor", "Risk Factor",
"Protective Factor", "Risk Factor",
"Risk Factor", "Risk Factor",
"Protective Factor", "Protective Factor",
"Risk Factor", "Risk Factor",
"Risk Factor", "Demographic/Personal Characteristic",
"Risk Factor", "Risk Factor",
"Risk Factor", "Risk Factor",
"Risk Factor", "Demographic/Personal Characteristic",
"Risk Factor", "Risk Factor",
"Risk Factor", "Risk Factor",
"Risk Factor", "Demographic/Personal Characteristic",
"Risk Factor", "Demographic/Personal Characteristic",
"Risk Factor", "Demographic/Personal Characteristic",
"Demographic/Personal Characteristic", "Risk Factor",
"Protective Factor", "Risk Factor",
"Demographic/Personal Characteristic", "Demographic/Personal Characteristic",
"Demographic/Personal Characteristic", "Demographic/Personal Characteristic",
"Protective Factor", "Demographic/Personal Characteristic",
"Demographic/Personal Characteristic")) %>%
ggplot(aes(x = permimp, y = reorder(labels, permimp), group = category, color = category)) +
geom_vline(xintercept = 0, colour="gray30", linetype = "solid") +
geom_segment(aes(yend = labels), xend = 0, colour = "black") +
geom_point(size = 3.5) +
labs(x = "Scaled Permutation Importance", y = "", title = "") +
scale_x_continuous(limits = c(-4, 25), expand = c(0, 0)) +
scale_color_manual(values = drwhycolors) +
theme_bw() +
theme(axis.text.x = element_text(size = 11),
axis.text.y = element_text(size = 11),
axis.title.x = element_text(size = 12),
legend.position = "bottom",
legend.title = element_blank(),
legend.text = element_text(size = 10))
impplot
# Continuous
mp_cont <- model_profile(explainer = explainer_rf, type = "conditional", N = NULL,
variables = c("dui", "infrndng",
"sedare1", "agedruginit",
"crime", "sedare4",
"grades_rev", "sedare3",
"anx"))
ale_cont <- mp_cont[["agr_profiles"]] #pull ALEs from profile
plot(ale_cont)
# Categorical
mp_cat <- model_profile(explainer = explainer_rf, type = "conditional", N = NULL,
variable_type = "categorical",
variables = c("alcdx", "cdapd", "demosex"))
ale_cat <- mp_cat[["agr_profiles"]] #pull ALEs from profile
plot(ale_cat)
View(results)
View(results_matrix)
baked %>%
select(-deid) %>%
tbl_summary(
by = drugdx,
type = list(
grades_rev ~ "continuous",
legalsev ~ "continuous",
pviclevel ~ "continuous",
pagglevel ~ "continuous",
crime ~ "continuous",
sedare1 ~ "continuous",
sedare2 ~ "continuous",
sedare3 ~ "continuous",
sedare4 ~ "continuous",
sedare5 ~ "continuous",
sedare6 ~ "continuous",
sedare7 ~ "continuous",
sedare8 ~ "continuous"
),
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"
),
digits = list(
all_categorical() ~ 1,
all_continuous() ~ 2
),
missing_text = "(Missing)"
) %>%
add_p(
test = list(
all_continuous() ~ "t.test"
),
pvalue_fun = ~ style_pvalue(.x, digits = 3)
) %>%
# modify_table_styling(
#   columns = "p.value",
#   rows = !is.na(p.value),  # Apply to all rows where p.value is not NA
#   fmt_fun = p_format
# ) %>%
bold_p()
# Total Sample
baked %>%
select(-deid) %>%
tbl_summary(
type = list(grades_rev ~ "continuous",
legalsev ~ "continuous",
pviclevel ~ "continuous",
pagglevel ~ "continuous",
crime ~ "continuous",
sedare1 ~ "continuous",
sedare2 ~ "continuous",
sedare3 ~ "continuous",
sedare4 ~ "continuous",
sedare5 ~ "continuous",
sedare6 ~ "continuous",
sedare7 ~ "continuous",
sedare8 ~ "continuous"),
statistic = list(
all_continuous() ~ "{mean} ({sd}) {min} - {max}",
all_categorical() ~ "{n} / {N} ({p}%)"),
digits = list(all_categorical() ~ 1,
all_continuous() ~ 2))
# By Group and Unadjusted Comparisons
# p_format <- function(x) {
#   ifelse(x < 0.01, "**", ifelse(x < 0.05, "*", ""))
# }
baked %>%
select(-deid) %>%
tbl_summary(
by = drugdx,
type = list(
grades_rev ~ "continuous",
legalsev ~ "continuous",
pviclevel ~ "continuous",
pagglevel ~ "continuous",
crime ~ "continuous",
sedare1 ~ "continuous",
sedare2 ~ "continuous",
sedare3 ~ "continuous",
sedare4 ~ "continuous",
sedare5 ~ "continuous",
sedare6 ~ "continuous",
sedare7 ~ "continuous",
sedare8 ~ "continuous"
),
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"
),
digits = list(
all_categorical() ~ 1,
all_continuous() ~ 2
),
missing_text = "(Missing)"
) %>%
add_p(
test = list(
all_continuous() ~ "t.test"
),
pvalue_fun = ~ style_pvalue(.x, digits = 3)
) %>%
# modify_table_styling(
#   columns = "p.value",
#   rows = !is.na(p.value),  # Apply to all rows where p.value is not NA
#   fmt_fun = p_format
# ) %>%
bold_p()
# Loops for Effect Sizes
# Function to calculate odds ratio for a categorical variable
calculate_odds_ratio <- function(data, var, group_var) {
contingency_table <- table(data[[var]], data[[group_var]])
odds_ratio <- oddsratio(contingency_table)$measure
return(odds_ratio)
}
# Function to calculate Cohen's d for a continuous variable
calculate_cohens_d <- function(data, var, group_var) {
groups <- split(data[[var]], data[[group_var]])
cohen_d <- cohen.d(groups[[1]], groups[[2]])
return(cohen_d)
}
# List of categorical and continuous variables
categorical_vars <- c(
"demosex", "livewith", "school", "gang1", "weapon1",
"weapon2a", "sexint", "publicass", "partnervic", "pcts", "binge",
"vgroup", "alcdx", "ptsd", "cdapd", "sexdrug", "mentman", "mentwoman",
"demoage_Age.14.to.17", "demoage_Age.18.to.20", "demoage_Age.21.to.24",
"demorac_AA.or.Black", "demorac_White", "demorac_Multiple.Races",
"demorac_American.Indian.Asian.Native.Hawaiian"
)
continuous_vars <- c(
"fight", "grades_rev", "reatt_rev", "pviclevel", "pagglevel", "agedruginit",
"legalsev", "dui", "infrndps", "infrndng", "parntsup", "prntdral",
"famanger", "nofight", "commviol", "bsi", "anx", "nprcts1to13",
"npects1to13", "crime", "sedare1", "sedare2", "sedare3", "sedare4",
"sedare5", "sedare6", "sedare7", "sedare8"
)
# Initialize lists to store results
odds_ratios <- list()
cohens_d <- list()
# Calculate odds ratios for categorical variables
for (var in categorical_vars) {
odds_ratios[[var]] <- calculate_odds_ratio(baked, var, "drugdx")
}
# Calculate Cohen's d for continuous variables
for (var in continuous_vars) {
cohens_d[[var]] <- calculate_cohens_d(baked, var, "drugdx")
}
# Display results
print("Odds Ratios for Categorical Variables:")
print(odds_ratios)
print("Cohen's d for Continuous Variables:")
print(cohens_d)
odds_ratios
baked %>%
select(-deid) %>%
tbl_summary(
by = drugdx,
type = list(
grades_rev ~ "continuous",
legalsev ~ "continuous",
pviclevel ~ "continuous",
pagglevel ~ "continuous",
crime ~ "continuous",
sedare1 ~ "continuous",
sedare2 ~ "continuous",
sedare3 ~ "continuous",
sedare4 ~ "continuous",
sedare5 ~ "continuous",
sedare6 ~ "continuous",
sedare7 ~ "continuous",
sedare8 ~ "continuous"
),
statistic = list(
all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"
),
digits = list(
all_categorical() ~ 1,
all_continuous() ~ 2
),
missing_text = "(Missing)"
) %>%
add_p(
test = list(
all_continuous() ~ "t.test"
),
pvalue_fun = ~ style_pvalue(.x, digits = 3)
) %>%
# modify_table_styling(
#   columns = "p.value",
#   rows = !is.na(p.value),  # Apply to all rows where p.value is not NA
#   fmt_fun = p_format
# ) %>%
bold_p()
odds_ratios
